（大多和）

1
それでは、私たち９班の発表を始めます。
私たちが制作したゲームはWood＆Rock BUILDERSというゲームです
(Enter)

2
それでは、まずチームメンバーの紹介をします。
まず、リーダーの大多和です。
ネットワークとマルチキャストを主に担当しています
次にメインプログラムやモデル・UI等を担当している江上です
最後にNPCのプログラムを担当している杉山です。
(Enter)

3
次にゲーム全体の概要を説明します。
プレイ人数は１人からプレイできます。
最大人数はn人です、一部1人専用のモードが存在します
プラットフォームはＰＣで
ジャンルはクラフト＆タワーディフェンスとアクションです。
右側の円の中にも書いてありますが街づくりをするモードがクラフト＆タワーディフェンス
採取をＮＰＣと共に行うモードがアクションとなっております
制作はUnityのURPで行っております
URPに関してはグラフィックに関しての説明の際に説明をしようと思います
(Enter)

4
全体動画

5
・操作方法について
拠点シーンの操作方法
WASDで移動　スペースでジャンプ
右クリックのドラッグでカメラ移動　Qキーでプレイヤー状態切り替え
他にも細々とした操作がありますが後で説明



（江上）

6
採取シーンの操作方法



（杉山）

7
それでは、シーン遷移について説明します
私たちのゲームはタイトルからログイン画面へとまず進みます
ログイン画面でプレイヤー名を入力してルーム選択に移ります
プレイするためのルームを選択するといよいよゲームプレイが開始となり、拠点のメインシーンへと移ります
拠点メインシーン内では建築・クラフト・防衛のそれぞれの行動をする際にそれぞれの画面へと切り替わります
拠点メインシーンではそれら以外にも採取シーンに遷移し、アクションミニゲームを遊ぶこともできます
採取シーンは終了するとリザルトシーンへと遷移し、そのままリザルトを終了すると拠点メインシーンへと戻ってきます
ゲーム終了する際には拠点メインシーンにてログアウトすることでゲーム終了することが出来ます
(Enter)



（大多和）

8
・ログインシーンについて
クリックでログイン画面へ
プレイヤー名を入れることで個人ルーム、追加してルームIDを入れることで他プレイヤーのルーム
ルームIDについては後で説明。どちらのルームに入るかを選択したら拠点に移行。

9
・拠点シーンについて
マルチプレイ可能なクラフトゲーム
左上の探索ボタンで後程説明する採取シーンへ移動
シーンの中でも三つのプレイヤー状態があり、Qキーで移行

10
移動をメインとした基本の状態
カメラの向きを変える、ジャンプ

11
オブジェクトを置ける建築状態
見下ろし型進行
地面にグリッド線、画面下にインベントリが表示
アイテムの選択はFキーで操作
置きたい家具を選択した状態で、左クリックで配置
右クリックで撤去
シフトを押しながらの右クリックで回転
置いた家具の上に積み重ねても置ける

12
家具を制作するクラフト状態
WSで上下に家具を選択、Shiftで制作
制作した家具は建築シーンにあるインベントリか、今から説明するアイテムバッグの中に保存

説明した三つの状態以外にもできる機能

13
アイテムバッグ
Eキーもしくは右下の鞄ボタン、所持アイテムの確認
インベントリに同じ種別のアイテムが一つも無い場合、アイテムバッグに保存
建築状態でインベントリを開き、左クリックでお互いに移し替え
再度Eキーを押すか閉じるボタンで終了

14
外見変更
Xキーもしくは右下のパレットボタン、プレイヤーの色変更
色相、明度、彩度の順にスライダーを移動し設定
再度Xキーを押すか閉じるボタンで終了し、データ保存

拠点シーンの主な説明は以上、採取シーンの説明へ



（江上）

15
採取パートについての解説をします。

採取パートは拠点で使用される資材やお金などを集めるためのパートです。
暗い森の中荷車を護衛して木などを集めながら敵を倒し、ゴール地点を目指すゲームとなっています。


16
NPCとのソロプレイと4人までのマルチプレイに対応していますが、最新バージョンではバグでマルチプレイが動作しないので今回はソロプレイでの動画になります。

それと、暗い森の雰囲気を再現するために全体的に暗めの画面になっとりますので、見やすくするために明度を上げていますので実際もうすこし暗くなっております
木などを攻撃してドロップした木ブロックを右クリックでつかみ荷車に近づき再度右クリックで積むことができます
。準備が整ったら、集合地点に集まり、全員が集まって一定時間経過すると進行が始まります。

荷車が発進すると敵が前後から湧くようになります敵の攻撃がプレイヤーに当たるとダメージを受け、荷車にあたると荷物を落としてしまいます。

道中ランダムで登場するギミックをいくつか紹介します。一つ目は倒木です。倒木にぶつかると木などをその場にドロップしてしまうのであらかじめ破壊しましょう
こちらは分かれ道です。看板を選択して左右どちらに進むか決定できます。右に行くと通常通りのルート、左に行くと危険だがリターンも多いルートとなっております。
一定時間ごとに夜がやってきます。夜は明かりをつけないと真っ暗なうえ、明かりの範囲内にいないと攻撃のヒット率が低下します。明かりは馬車の後ろに近づいてFキーを押すと
木を消費して数秒間明かりをつけられます。
一定時間ごとにアーティファクトが出現します。これはショップで、木を入手、倒木を除去、ドロップ数2倍などのバフなどがランダムで出現します。
わかりづらくてすみません。これは中ボスです。中ボスは2人以上で戦わないと倒せない程度の強さになっています。倒すと宝箱をドロップし、大量のコインや木を獲得できます
ボスバトルです。終点に近づくとボスとの戦闘になります。ボスを倒すと、リザルト画面に移り、獲得した物資を持ち帰れます

17
採取では主に4つのアイテムを獲得できます。木を攻撃することで木を、岩を攻撃することで鉱石、薬草を積むことで回復、草を攻撃して確率でコインがドロップします。

18
60秒ごとのスパンで夜が来ます。夜は視界が阻害され、明かりの中にいないと攻撃が当たりづらくなってしまいます。また、敵の湧く頻度や量も上がります
木を消費して明かりをつけれます木1つごとに3秒、最大15秒間継続して明かりをつけられます。ソロプレイ中ではNPCが勝手にきつけてくれますが、マルチプレイの場合は
だれかを火の管理役にするのをお勧めします。

19
4分半ごとにルートが分岐します。プレイヤーが左右どちらかを選択することで選択した方向に進みます。選ばれなかった方の看板は落ちます。
右はローリスクローリターン、左の場合はハイリスクハイリターンなルートとなります。

20
アーティファクトです。アーティファクトは名ばかりのショップのことで、コインを消費することでいろいろなものが購入できます。動画では400コイン支払い
25個の木を購入しています。ショップに関してはNPCは使用しません。

21
ボスを倒すとリザルト画面に映ります。採取で入手したものをそのまま拠点に持ち帰ることができます。回復アイテムに関しては持ち帰れないので、もったいぶらずにどんどん使いましょう

22
開発にあたってURPを採用しました。理由としてはビルトインより軽くすることができ、ポストエフェクトを利用して表現できる幅が広がるからです
アーティファクトの光の表現などもこだわりました。

23
ポストエフェクト、を適用することで一気に表現の幅が広がります。暗い森の中を表現するためにポストエフェクトを自作しました

24
エフェクトもいくつか自作しました。URPの機能のシェーダーグラフを利用しました

25
モデルはアセットと自作が混在しています。自作のものは軽量化を意識してローポリになるように作り。ハイポリのアセットはポリゴンを削り軽量化しました

26
Tewwnについてです。Tweenとはunityにおいてスクリプトによるアニメーションのことを言います。代表的なアセットにHOTweenやDOTweenなどがあります。
今回はこの投げるアニメーションのためにTweenを自作しました。投げるアニメーションはこのウッドトランスフォームTWスロー、終点、パワー、秒数
この1行のコードだけでアニメーションされています

27
今回開発で意識した点として軽量化、最適化があります。最適化とはゲームの動作を軽くすること全般を言います。よく最適化されてないゲームが重いなどSNSで見かけることがあると思いますが
そのことです

アセットはブレンダーでデメシート、つまりポリゴン数の削減を行い軽量化

オクルージョンを適用してカメラ外のオブジェクトを透明化してGPUへの負荷を軽減して描画速度の向上しました

transformのアクセスは内部的にはgetcomponentをが内部的に実行されているので重くなる原因となるgetcomponentを省略してキャッシュしておくことで数ミリ秒アクセスが高速化します
所詮数ミリ秒かと思いますが、updateで毎フレームアクセスしている箇所もあるので全体的にかなり早くなります

容量の大きくなる主な原因であるテクスチャを圧縮して読み込む際に展開することで容量の削減になります

これはだれでもマネできることです空のupdateは消しましょう。毎フレーム「無」が実行されてるので重くなる原因となります

以上私の担当させていただいた個所となります



（杉山）

28
それでは、私からNPCの説明をします。
現在画面に映っているのが、採取をする際に助けてくれる味方のNPCです。
味方NPCは全部で3体となっており、プレイヤー同様に素材を集める、敵に攻撃する、火を点火するなどを行います
味方NPCはプレイヤーの行動を基にして、変化するようにしています
(Enter)

29
それでは味方のNPCの動きの動画をいくつかご覧ください
この動画はNPCが素材を採取する様子です。
この子たちは初期の状態でターゲットとするオブジェクトは自らに一番近いオブジェクトをターゲットにするようになっています
同じオブジェクトを皆で取りに行ったりもしていますね
敵をターゲットにしているならこれでも構わないような気がしますがアイテムオブジェクトならそれぞれ別のものを取りに行って欲しいですね
(Enter)

30
それでは次の動画です。
素材を採取する部分は同じですが、先程とは違いそれぞれが別のものをターゲットにしていることがわかると思います
これは採取ゲームを何回かプレイした結果の成長したNPCとなります
味方NPCは採取ゲームをプレイすることで経験値的要素を得てレベルが上がり成長するようになっています
(Enter)

31
それでは次の動画です。
これはプレイヤーが敵に追いかけられていますね。
NPC君達が画面外からNPC君達が助けに来ていますね
NPC達はアイテムよりも敵を優先してターゲットにするようになっています
そんなこと言ってる間に敵をぼこぼこにして倒しましたね
(Enter)

32
ここで味方NPCの成長要素の管理をしている味方NPCのJSONに関しての説明をします
JSONとは「JavaScript Object Notation」の略で、「JavaScriptのオブジェクトの書き方を元にしたデータ定義方法」のことです。
セーブ機能などを作る際によく利用されています。
今回はNPCステータスを機能を保存しておくためのファイルと考えてください
今回のNPCに関してもそれで変化するNPCのステータス要素をセーブするために用いています
採取ゲームをプレイする際に味方NPCのデータとして取り込みます。
採取シーンをクリアした後のリザルトにてその時の採取ゲームでの結果を元にステータスデータを保存します
こうすることで次回のプレイでは今回のデータを取り込んで遊ぶことが出来ます
(Enter)

33
次に敵NPCの説明をします
この画像に映っている敵ですが、一番左の小さいのが通常エネミー、いわゆる雑魚敵となります
真ん中が中型エネミー、一番右の一番大きい敵が大型エネミー、いわゆるボスとなっています
(Enter)

34
それでは動画を一つご覧ください
先程の味方NPCの紹介でも見た場所ですね
今回は敵NPCの共通の動きの説明をします
敵NPCはプレイヤーを基本的に追尾するように設定しています
そしてプレイヤーが一定範囲内に入ると攻撃をするようになっています
攻撃をする際に範囲がわかるように前兆が表示されるようになっています
攻撃範囲内にいるとダメージを受けていますね
(Enter)

35
次にそれぞれの攻撃方法について説明します
通常エネミーは体当たりとなっています
範囲も威力も低く設定しています
(Enter)

36
次は中型エネミーの攻撃方法です
動画内でも何回か見えていた攻撃ですね
円状の範囲攻撃です。
前兆を見逃さなければ避けるのは簡単な攻撃です

37
最後に大型エネミーの攻撃方法です
攻撃方法は4パターンで左上が中型と同じ範囲攻撃
右上が扇型範囲にダメージを与える攻撃
左下が突進攻撃、右下が回転攻撃です
敵エネミー紹介の際の大型の大きさですべてが繰り出されるので避けるのもなかなか難しいものとなっています
これらに対処し、大型エネミーを倒せれば採取ゲームクリアとなります
(Enter)




（大多和）
マルチプレイを実装するにあたっての技術点の説明です

38
・データ保存の技術点について
保存形式をJSONにし、起動中はUnityの機能であるDictionary型へ変換することで、参照のしやすいデータ形式を作成
Dictionary型…名の通り辞書型
例：アイテムデータの保存方法
Keyという辞書で言う検索ワードにアイテム名、検索結果のValueにJsonから変換したクラスデータを挿入し保存
拠点シーンで配置した家具の座標データなども同じように管理

39
・マルチプレイについて
動画を見ながら説明
ルームマスターとなる一人が個人ルームに入り、左上のノートボタンをクリックしてルームIDである自分のIPアドレスをクリップボードヘコピー、メンバーたちへ共有
共有されたIDを入力しログイン
プレイヤーの動作、家具の配置情報などが自動で共有

40
実装方法について
実装にはマルチキャストを使用。そもそもマルチキャストとは？
イメージとしてはライングループ
初めにライングループとなる宛先IPアドレスを作成し、メンバーは参加要請を出すことでマルチキャストグループへ参加。
あとは宛先IPアドレス宛にデータを送ると、自動で参加しているメンバー全員にデータが送信される

41
マルチキャストの他にもユニキャスト、ブロードキャストがある
ユニキャスト…ラインの個別トーク、ブロードキャスト…タイムライン
メリット…
一対一で通信を行うユニキャストや、無差別にデータを送信するブロードキャストに比べ、多人数へのデータ送信処理が重くならない
デメリット…
ユニキャスト、ブロードキャストと違い、同一の機内LANでのみ通信が可能。インターネット全域は不可

42
パケットの通信方法について
TCP、UDPの二種類がある。今回はUDPを使用
選択理由…確実にパケットを処理するTCPにくらべ、一方的にデータを送る分処理が軽く、多少送信途中でロストしても問題のない大量のパケット通信に向いている

44
以上簡単に説明したものをプログラムとして作成する
Awackで最初に自分のパソコンのIPアドレスを取得し、マルチキャストの宛先IPアドレスとポート番号を設定しておいてから、別のスタートマルチキャストという処理へ飛ぶ
ちなみに受信処理はメインスレッドでやると重くなるので、別にスレッドを立てて処理を開始

45
スタートマルチキャスト……UDPソケットの作成と設定
IPアドレスとポート番号、マルチキャストアドレスを参照しつつ、ソケットを組み立てれば最初の工程は完了
送信、受信処理については基本的なものなので割愛。興味のある方はぜひ

46
・統括
メンバー全員が初めてのことに挑戦したので、技術点に自信のあるゲームになった
AWS、Python、Blenderなど機能試験の関係で使わなかった技術が多い
全体的にゲームの軽量化を心掛けた

47
ご清聴ありがとうございました

48
質疑応答